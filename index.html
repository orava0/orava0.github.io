<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Jukola 2026 – valitse karttataso</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS ja JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { width: 100%; height: 100%; }

    #layerToggle {
      position: absolute;
      top: 10px;
      left: 60px;
      background: white;
      z-index: 1000;
      padding: 6px 8px;
      font-family: sans-serif;
      font-size: 16px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      line-height: 1.4;
    }

    /* Pieni On/Off-nappi */
    #onOffBtn {
      display: inline-block;
      margin-bottom: 6px;
      padding: 4px 8px;
      font-size: 14px;
      border: 1px solid #888;
      border-radius: 4px;
      background: #f7f7f7;
      cursor: pointer;
    }
    #onOffBtn.off {
      background: #eee;
      color: #666;
    }

    /* Linkki “Kuvitteellisia rasteja” -karttaan */
    #rastejaLink {
      display: inline-block;
      margin-left: 4px;
      margin-top: 4px;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid #888;
      background: #f7f7f7;
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
    #rastejaLink:hover {
      background: #e6e6e6;
    }

    #mouseCoords {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.9);
      font-family: sans-serif;
      font-size: 14px;
      padding: 4px 10px;
      z-index: 1000;
      pointer-events: none;
    }
  </style>
</head>
<body>

<!-- Jos alta poistaa kommentoinnin, niin alareunaan saa nakyville koordinaatit. -->
<!-- <div id="mouseCoords">Koordinaatit: </div> -->

<div id="layerToggle">
  <!-- UUSI On/Off-nappi -->
  <button id="onOffBtn" type="button" title="Näytä/piilota valittu taso">On/Off</button>
  <br>
  <label><input type="radio" name="layer" value="satelliitti"> SATELLIITTIKUVA</label><br>
  <label><input type="radio" name="layer" value="maasto" checked> Maastokartta</label><br>
  <label><input type="radio" name="layer" value="rinnevarjoste"> Rinnevarjoste</label><br>
  <label><input type="radio" name="layer" value="esijukola"> Esi-Jukola</label><br>
  <label><input type="radio" name="layer" value="efky1"> Kymin lentokenttä</label><br>
  <label><input type="radio" name="layer" value="efky2"> Kymin lentokenttä 2</label><br>  
  <label><input type="radio" name="layer" value="tavastila"> Tavastila</label><br>
  <label><input type="radio" name="layer" value="peippola"> Peippola</label><br>
  <label><input type="radio" name="layer" value="kirkkovuoret"> Kirkkovuoret</label><br>
  <label><input type="radio" name="layer" value="kooste"> Vanhojen kooste</label><br>
  <label><input type="radio" name="layer" value="saarijarvi"> Saarijärvi, 1986</label><br>  
  <label><input type="radio" name="layer" value="1986"> Fin 5, 1986</label><br>
  <label><input type="radio" name="layer" value="1975"> SM-viesti, 1975</label><br>

  <!-- Viimeinen rivi + linkki uuteen sivuun -->
  <label>
    <input type="radio" name="layer" value="rasteja">
    Rasteja
  </label>
  <!-- VAIHDA href jos sivun nimi on eri -->
  <a id="rastejaLink" href="rastit.html" target="_blank">
    Uusi välilehti
  </a>
</div>

<div id="map"></div>

<script>
  const map = L.map('map', {
    center: [60.5750, 26.8939],
    zoom: 14,
    minZoom: 13,
    maxZoom: 17
  });

  const mouseEl = document.getElementById('mouseCoords');
  map.on('mousemove', function(e) {
    if (!mouseEl) return; // suojataan, jos palkki ei ole käytössä
    const lat = e.latlng.lat.toFixed(5);
    const lng = e.latlng.lng.toFixed(5);
    mouseEl.textContent = `Koordinaatit: ${lat}, ${lng}`;
  });

  const esriLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Karttakuva © Esri & contributors',
    maxZoom: 19
  });
  esriLayer.addTo(map); // Satelliittikuva pysyvästi taustalle

  const maastoLayer = L.tileLayer('omakartta_tiles/{z}/{x}/{y}.png', {
    tileSize: 256,
    minZoom: 1,
    maxZoom: 17,
    opacity: 1,
    tms: true
  });

  let efkyOverlay = null;

  function addEfkyImage(src, lat, lon, widthKm, heightKm, angleDeg) {
    removeEfkyOverlay();

    const latlng = L.latLng(lat, lon);
    const center = map.latLngToLayerPoint(latlng);

    const kmToPx = (km) => {
      const p1 = map.latLngToLayerPoint(latlng);
      const p2 = map.latLngToLayerPoint(L.latLng(lat + (km / 111.32), lon));
      return Math.abs(p2.y - p1.y);
    };

    const widthPx = kmToPx(widthKm);
    const heightPx = kmToPx(heightKm);

    const img = document.createElement('img');
    img.src = src;
    img.style.position = 'absolute';
    img.style.width = `${widthPx}px`;
    img.style.height = `${heightPx}px`;
    img.style.left = `${center.x - widthPx / 2}px`;
    img.style.top = `${center.y - heightPx / 2}px`;
    img.style.transform = `rotate(${angleDeg}deg)`;
    img.style.transformOrigin = 'center center';
    img.style.opacity = '1.0';
    img.style.pointerEvents = 'none';
    img.style.zIndex = '999';
    img.style.mixBlendMode = 'normal';

    efkyOverlay = img;
    map.getPanes().overlayPane.appendChild(img);
  }

  function removeEfkyOverlay() {
    if (efkyOverlay && efkyOverlay.parentNode) {
      efkyOverlay.parentNode.removeChild(efkyOverlay);
      efkyOverlay = null;
    }
  }

  // Näkyvyyden tila valitulle tasolle (oletuksena päällä)
  let layerVisible = true;

  function updateLayers() {
    if (!layerVisible) {
      map.removeLayer(maastoLayer);
      removeEfkyOverlay();
      return;
    }

    map.removeLayer(maastoLayer);
    removeEfkyOverlay();

    const valinta = document.querySelector('input[name="layer"]:checked').value;

    if (valinta === 'maasto') {
      maastoLayer.addTo(map);
    } else if (valinta === 'esijukola') {
      addEfkyImage('EsiJukola.jpg', 60.56836, 26.92413, 3.48, 3.015, 11.2);
    } else if (valinta === 'efky1') {
      addEfkyImage('EFKY_1.jpg', 60.57796, 26.8853, 2.12, 2.94, 7.3);
    } else if (valinta === 'efky2') {
      addEfkyImage('EFKY_2.jpg', 60.58616, 26.87696, 2.83, 4.09, 7.3);    
    } else if (valinta === 'tavastila') {
      addEfkyImage('Tavastila.jpg', 60.57469, 26.93866, 2.00, 2.93, 7.5);
    } else if (valinta === 'peippola') {
      addEfkyImage('Peippola.jpg', 60.56246, 26.91016, 2.10, 3.00, 7.7);
    } else if (valinta === 'kirkkovuoret') {
      addEfkyImage('Kirkkovuoret.jpg', 60.60961, 26.90236, 2.96, 2.12, 8.7);
    } else if (valinta === 'saarijarvi') {
      addEfkyImage('Saarijarvi.jpg', 60.60056, 26.89086, 8.48, 6.03, 5.1);
    } else if (valinta === '1986') {
      addEfkyImage('EFKY_3.jpg', 60.55766, 26.90186, 6.52, 9.21, 5.2); 
    } else if (valinta === '1975') {
      addEfkyImage('EFKY_4.jpg', 60.59146, 26.90586, 5.24, 7.39, 5.4); 
    } else if (valinta === 'kooste') {
      addEfkyImage('Kooste.jpg', 60.58716, 26.88561, 8.305, 11.97, 8.4);
    } else if (valinta === 'rinnevarjoste') {
      addEfkyImage('rinnevarjoste.jpg', 60.59526, 26.89291, 8.815, 7.4, 0);
    } else if (valinta === 'rasteja') {
      addEfkyImage('Kooste_kuvitteellisilla_rasteilla.jpg', 60.58716, 26.88561, 8.305, 11.97, 8.4);
    }
  }

  // Radiopainikkeet vaihtavat valittua tasoa
  document.querySelectorAll('input[name="layer"]').forEach(el => {
    el.addEventListener('change', updateLayers);
  });

  // Zoom/move päivitys vain jos taso näkyy
  map.on('zoomend moveend', () => {
    if (layerVisible) {
      const valinta = document.querySelector('input[name="layer"]:checked').value;
      if (
        valinta.startsWith('efky') ||
        ['tavastila','peippola','kirkkovuoret','saarijarvi','kooste','1975','1986','esijukola','rasteja','rinnevarjoste'].includes(valinta)
      ) {
        updateLayers();
      }
    }
  });

  // On/Off-nappi
  const onOffBtn = document.getElementById('onOffBtn');
  onOffBtn.addEventListener('click', () => {
    layerVisible = !layerVisible;
    if (layerVisible) {
      onOffBtn.classList.remove('off');
      updateLayers();
    } else {
      onOffBtn.classList.add('off');
      map.removeLayer(maastoLayer);
      removeEfkyOverlay();
    }
  });

  // Oletuksena maastokartta päälle myös toiminnallisesti
  maastoLayer.addTo(map);
</script>

</body>
</html>
