<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Käännettävä ja zoomattava suunnistuskartta</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                         Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #000;
            color: #eee;
            height: 100vh;
            overflow: hidden;        /* koko näkymä kartalle + overlaylle */
        }

        .container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .map-wrapper {
            position: absolute;
            inset: 0;                /* top:0; right:0; bottom:0; left:0; */
            overflow: auto;          /* scrollit */
            cursor: grab;
            background: #000;
            padding: 0.5rem;
        }

        .map-wrapper.dragging {
            cursor: grabbing;
        }

        .map-inner {
            display: inline-block;
        }

        #mapImage {
            width: 150%;    /* lähtözoom 150 % */
            height: auto;
            max-width: none;
            max-height: none;
            transform-origin: center center;
            transform: rotate(0deg);
            transition: transform 0.05s linear;
            display: block;
            user-select: none;
            -webkit-user-drag: none;
        }

        /* --- Overlay-kontrollit kartan päällä --- */
        .controls-overlay {
            position: absolute;
            left: 50%;
            bottom: 1rem;
            transform: translateX(-50%);
            background: rgba(34, 34, 34, 0.9);
            padding: 0.75rem 1rem 0.9rem;
            border-radius: 1rem;
            max-width: 90vw;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        .controls-overlay h1 {
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0 0 0.4rem;
            text-align: center;
        }

        .section-title {
            font-size: 0.8rem;
            font-weight: 600;
            margin: 0.2rem 0 0.1rem;
            opacity: 0.9;
        }

        .slider-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.1rem;
        }

        .slider-row label {
            white-space: nowrap;
            font-size: 0.85rem;
        }

        .slider-row span.value-label {
            white-space: nowrap;
            font-variant-numeric: tabular-nums;
            font-size: 0.85rem;
            min-width: 4.5rem;
            text-align: right;
        }

        input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 1rem;
            border-radius: 999px;
            background: linear-gradient(to right, #444 0%, #555 100%);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 1.2rem;
            height: 1.2rem;
            border-radius: 50%;
            background: #ffb300;
            border: 2px solid #222;
            box-shadow: 0 0 6px rgba(0,0,0,0.6);
            cursor: pointer;
            margin-top: -0.1rem;
        }

        input[type="range"]::-moz-range-thumb {
            width: 1.2rem;
            height: 1.2rem;
            border-radius: 50%;
            background: #ffb300;
            border: 2px solid #222;
            box-shadow: 0 0 6px rgba(0,0,0,0.6);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-track {
            height: 1rem;
            border-radius: 999px;
            background: linear-gradient(to right, #444 0%, #555 100%);
        }

        .buttons-row {
            display: flex;
            gap: 0.4rem;
            margin-top: 0.4rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            border: none;
            border-radius: 999px;
            padding: 0.25rem 0.8rem;
            font-size: 0.8rem;
            background: #333;
            color: #eee;
            cursor: pointer;
        }

        button:hover,
        button:active {
            background: #444;
        }

        button.primary {
            background: #ffb300;
            color: #222;
            font-weight: 600;
        }

        button.primary:hover,
        button.primary:active {
            background: #ffca3a;
        }

        .hint {
            text-align: center;
            margin-top: 0.3rem;
            font-size: 0.75rem;
            color: #aaa;
        }

        @media (max-width: 600px) {
            .controls-overlay {
                bottom: 0.5rem;
                padding: 0.6rem 0.7rem 0.7rem;
            }
        }
    </style>
</head>
<body>
<div class="container">

    <div class="map-wrapper" id="mapWrapper">
        <div class="map-inner">
            <img id="mapImage" src="Kooste_kuvitteellisilla_rasteilla.jpg" alt="Suunnistuskartta">
        </div>
    </div>

    <div class="controls-overlay">
        <h1>Käännä ja zoomaa karttaa</h1>

        <!-- Kierto -->
<!--        <div class="section-title">Kierto (asteet)</div>	-->
        <div class="slider-row">
            <label for="rotationRange">Kierto</label>
            <input id="rotationRange" type="range" min="-180" max="180" value="0" step="1">
            <span id="rotationValue" class="value-label">0°</span>
        </div>

<!--
        <div class="buttons-row">
            <button type="button" data-step="-30">−30°</button>
            <button type="button" data-step="-10">−10°</button>
            <button type="button" data-step="-1">−1°</button>
            <button type="button" data-step="1">+1°</button>
            <button type="button" data-step="10">+10°</button>
            <button type="button" data-step="30">+30°</button>
        </div>
-->
        <!-- Zoom -->
        <div class="section-title" style="margin-top:0.5rem;">Zoom</div>
        <div class="slider-row">
<!--            <label for="zoomRange">Zoom</label>	-->
            <input id="zoomRange" type="range" min="0.5" max="8" value="1.5" step="0.1">
            <span id="zoomValue" class="value-label">150 %</span>
        </div>

        <div class="buttons-row">
            <button type="button" data-zoom-step="-0.2">−</button>
            <button type="button" data-zoom-step="0.2">+</button>
            <button type="button" class="primary" id="resetAll">Reset (0° / 100%)</button>
        </div>
<!--
        <div class="hint">
            Zoomaa liukusäätimellä tai +/− -napeilla.  
            Siirrä karttaa tarttumalla siihen hiirellä tai sormella ja vetämällä.
        </div>
-->
    </div>
</div>

<script>
    (function () {
        const img = document.getElementById('mapImage');
        const mapWrapper = document.getElementById('mapWrapper');

        img.draggable = false;

        // Kierto
        const rotationSlider = document.getElementById('rotationRange');
        const rotationValueSpan = document.getElementById('rotationValue');
        const rotationButtons = document.querySelectorAll('.buttons-row button[data-step]');

        // Zoom
        const zoomSlider = document.getElementById('zoomRange');
        const zoomValueSpan = document.getElementById('zoomValue');
        const zoomButtons = document.querySelectorAll('.buttons-row button[data-zoom-step]');
        const resetAllBtn = document.getElementById('resetAll');

        let currentRotation = 0;
        let currentScale = 1.5; // lähtözoom

        function updateTransform() {
            img.style.transform = `rotate(${currentRotation}deg)`;
            img.style.width = (currentScale * 100) + '%';
        }

        function setRotation(deg) {
            const clamped = Math.max(-180, Math.min(180, deg));
            currentRotation = clamped;
            rotationSlider.value = clamped;
            rotationValueSpan.textContent = `${clamped}°`;
            updateTransform();
        }

        function setZoom(scale) {
            const clamped = Math.max(0.5, Math.min(8, scale));

            // Ennen zoomia: selvitetään, mikä kohta sisällöstä on nyt ruudun keskellä
            const rect = mapWrapper.getBoundingClientRect();
            const prevW = mapWrapper.scrollWidth;
            const prevH = mapWrapper.scrollHeight;

            const centerX = mapWrapper.scrollLeft + rect.width / 2;
            const centerY = mapWrapper.scrollTop + rect.height / 2;

            // Keskipisteen suhteellinen sijainti (0..1) sisällössä
            const relX = prevW > 0 ? centerX / prevW : 0.5;
            const relY = prevH > 0 ? centerY / prevH : 0.5;

            // Päivitetään mittakaava
            currentScale = clamped;
            zoomSlider.value = clamped;
            zoomValueSpan.textContent = `${Math.round(clamped * 100)} %`;
            updateTransform();

            // Zoomin jälkeen: sisällön uusi koko
            const newW = mapWrapper.scrollWidth;
            const newH = mapWrapper.scrollHeight;

            const newCenterX = newW * relX;
            const newCenterY = newH * relY;

            // Skrollataan niin, että sama piste pysyy näkymän keskellä
            mapWrapper.scrollLeft = newCenterX - rect.width / 2;
            mapWrapper.scrollTop  = newCenterY - rect.height / 2;
        }

        function resetView() {
            currentRotation = 0;
            currentScale = 1;
            rotationSlider.value = 0;
            zoomSlider.value = 1;
            rotationValueSpan.textContent = '0°';
            zoomValueSpan.textContent = '100 %';
            updateTransform();

            const rect = mapWrapper.getBoundingClientRect();
            mapWrapper.scrollLeft = (mapWrapper.scrollWidth - rect.width) / 2;
            mapWrapper.scrollTop  = (mapWrapper.scrollHeight - rect.height) / 2;
        }

        // Alkuasetus, kun kaikki on ladattu
        window.addEventListener('load', () => {
            updateTransform();
            const rect = mapWrapper.getBoundingClientRect();
            mapWrapper.scrollLeft = (mapWrapper.scrollWidth - rect.width) / 2;
            mapWrapper.scrollTop  = (mapWrapper.scrollHeight - rect.height) / 2;
            zoomValueSpan.textContent = `${Math.round(currentScale * 100)} %`;
            rotationValueSpan.textContent = '0°';
        });

        // Kierto – liukusäädin
        rotationSlider.addEventListener('input', function () {
            setRotation(parseInt(this.value, 10) || 0);
        });

        // Kierto – napit (sinulla kommentoituna -> ei haittaa, lista vain tyhjä)
        rotationButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const step = parseInt(this.getAttribute('data-step'), 10) || 0;
                setRotation(currentRotation + step);
            });
        });

        // Zoom – liukusäädin
        zoomSlider.addEventListener('input', function () {
            setZoom(parseFloat(this.value) || 1);
        });

        // Zoom – napit
        zoomButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const step = parseFloat(this.getAttribute('data-zoom-step')) || 0;
                setZoom(currentScale + step);
            });
        });

        // Reset
        resetAllBtn.addEventListener('click', resetView);

        // ---------- RAHAAMINEN HIIRIELLE ----------
        let isDragging = false;
        let startX = 0;
        let startY = 0;
        let startScrollLeft = 0;
        let startScrollTop = 0;

        mapWrapper.addEventListener('mousedown', function (e) {
            if (e.button !== 0) return; // vain vasen nappi
            isDragging = true;
            mapWrapper.classList.add('dragging');
            startX = e.clientX;
            startY = e.clientY;
            startScrollLeft = mapWrapper.scrollLeft;
            startScrollTop = mapWrapper.scrollTop;
            e.preventDefault();
        });

        window.addEventListener('mousemove', function (e) {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            mapWrapper.scrollLeft = startScrollLeft - dx;
            mapWrapper.scrollTop  = startScrollTop - dy;
        });

        window.addEventListener('mouseup', function () {
            if (!isDragging) return;
            isDragging = false;
            mapWrapper.classList.remove('dragging');
        });

        // ---------- RAHAAMINEN KOSKETUKSELLE ----------
        let isTouchDragging = false;
        let touchStartX = 0;
        let touchStartY = 0;
        let touchStartScrollLeft = 0;
        let touchStartScrollTop = 0;

        mapWrapper.addEventListener('touchstart', function (e) {
            if (e.touches.length !== 1) return;
            isTouchDragging = true;
            mapWrapper.classList.add('dragging');

            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            touchStartScrollLeft = mapWrapper.scrollLeft;
            touchStartScrollTop = mapWrapper.scrollTop;
        }, { passive: false });

        mapWrapper.addEventListener('touchmove', function (e) {
            if (!isTouchDragging) return;
            if (e.touches.length !== 1) return;
            e.preventDefault();

            const touch = e.touches[0];
            const dx = touch.clientX - touchStartX;
            const dy = touch.clientY - touchStartY;

            mapWrapper.scrollLeft = touchStartScrollLeft - dx;
            mapWrapper.scrollTop  = touchStartScrollTop - dy;
        }, { passive: false });

        function endTouchDrag() {
            if (!isTouchDragging) return;
            isTouchDragging = false;
            mapWrapper.classList.remove('dragging');
        }

        mapWrapper.addEventListener('touchend', endTouchDrag);
        mapWrapper.addEventListener('touchcancel', endTouchDrag);
    })();
</script>

</body>
</html>
